---
layout: post
title:  "kubernetes와 ML #2"
date:   2019-02-24 13:01:00
categories: kubernetes ml k8s docker machine-learning
---
이번 포스트에서는 쿠버네티스 환경을 구축해보고 직접 여러 개의 모델을 훈련시켜 보아 기존 방법에 비해 어떤 부분들이 더 좋은지 알아보도록 하겠습니다.

#### kubernetes 환경 구축

쿠버네티스 클러스터를 직접 구축하는 일은 그리 간단하지 않습니다. 저는 AWS 클라우드 상에서 클러스터를 구축하는 방법을 소개해 드리겠습니다. 크게 3가지 방법이 있습니다.

##### 1. CloudFormation 이용
heptio 라는 회사에서 cloudformation template 형태로 쉽게 쿠버네티스 클러스터를 구축할 수 있게 만들어 놓았습니다. 쿠버네티스를 처음 접하시는 분이라면 어떤 방식으로 클러스터가 구성되는지 파악할 수 있는 좋은 자료가 됩니다. 이번 시간에는 해당 방법을 이용해서 클러스터를 구축할 예정입니다.
##### 2. kops 이용
AWS 상에서 쉽게 클러스터를 구축할 수 있게 도와주는 오픈소스 tool입니다. 운영 환경에서 많은 분들이 kops 툴을 이용하여 쿠버네티스 클러스터를 구축합니다. 기본적으로 Route53, S3 서비스 등을 사용하기 때문에 많은 권한을 요구하기도 합니다.
##### 3. eksctl 이용
AWS에서 제공하는 쿠버네티스 managed 서비스인 Amazon EKS를 사용하시는 경우라면 eksctl CLI 툴을 이용하여 쉽게 쿠버네티스 클러스터를 구축하실 수 있습니다. 위 2개 방법과는 다르게 쿠버네티스 마스터 자체를 AWS에서 직접 관리하게 때문에 관리 포인트가 줄어든다는 장점이 있습니다. 대신 어느 정도 cloud platform에 락인되게 됩니다.

#### Heptio CloudFormation Launch

1. 먼저 아래의 주소로 들어가서 `배포방법 - 새 VPC에 배포`을 클릭합니다.
[https://aws.amazon.com/quickstart/architecture/heptio-kubernetes/](https://aws.amazon.com/ko/quickstart/architecture/heptio-kubernetes/)

2. 기본적으로 us-west-2 리전으로 설정되어 있습니다. 본인의 상황에 맞는 리전을 선택하시기 바랍니다. 저 같은 경우는 서울 (ap-northeast-2) 리전을 선택하도록 하겠습니다. `다음` 을 클릭

3. 빈칸에 아래와 같이 정보를 입력하시기 바랍니다.

- Stack Name: CloudFormation stack 이름, 자유롭게 입력, 저는 `k8s-stack` 이라 입력
- Availability Zone선택: ap-northeast-2a
- Admin Ingress Location: 0.0.0.0/0
- SSH Key: 본인이 사용하고 있는 pem key
- Node Capacity: 테스트할 worker node 개수, 기본 2개
- 나머지는 default 값으로 설정
- 끝까지 `다음` 버튼 클릭
- 마지막 기능에 리소스 권한 승인 —> `승인`

승인 버튼을 누르게 되면 CloudFormation stack이 생성되기 시작합니다. CloudFormation dashboard에 k8s-stack이라는 이름의 stack이 CREATING 중이라고 표시됩니다.

최종적으로 아래와 같은 클러스터를 구성되게 됩니다.

![](/assets/images/k8s_ml/heptio_cf.png)
